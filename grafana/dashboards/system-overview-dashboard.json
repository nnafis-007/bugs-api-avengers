{
  "title": "System Overview Dashboard",
  "uid": "system-overview",
  "tags": ["overview", "system", "health"],
  "timezone": "browser",
  "panels": [
    {
      "title": "Service Health Status",
      "type": "stat",
      "gridPos": {"h": 6, "w": 24, "x": 0, "y": 0},
      "targets": [{
        "expr": "up{job=~\"backend|campaign-service|backend-consumer|postgres|redis\"}",
        "legendFormat": "{{job}}",
        "instant": true
      }],
      "options": {
        "graphMode": "none",
        "colorMode": "background",
        "orientation": "horizontal",
        "mappings": [
          {"value": 1, "text": "UP", "color": "green"},
          {"value": 0, "text": "DOWN", "color": "red"}
        ]
      }
    },
    {
      "title": "Total Request Rate (All Services)",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
      "targets": [{
        "expr": "sum(rate(http_requests_total[5m])) by (job)",
        "legendFormat": "{{job}}"
      }],
      "yaxes": [{"format": "reqps"}, {"format": "short"}]
    },
    {
      "title": "Error Rate (All Services)",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
      "targets": [{
        "expr": "sum(rate(http_requests_total{status_code=~\"5..\"}[5m])) by (job)",
        "legendFormat": "{{job}}"
      }],
      "yaxes": [{"format": "errors/s"}, {"format": "short"}]
    },
    {
      "title": "CPU Usage (All Containers)",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 14},
      "targets": [{
        "expr": "rate(container_cpu_usage_seconds_total{name=~\"login_.*\"}[1m]) * 100",
        "legendFormat": "{{name}}"
      }],
      "yaxes": [{"format": "percent", "max": 100}, {"format": "short"}]
    },
    {
      "title": "Memory Usage (All Containers)",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 14},
      "targets": [{
        "expr": "container_memory_usage_bytes{name=~\"login_.*\"}",
        "legendFormat": "{{name}}"
      }],
      "yaxes": [{"format": "bytes"}, {"format": "short"}]
    },
    {
      "title": "Network I/O (All Containers)",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 22},
      "targets": [{
        "expr": "rate(container_network_receive_bytes_total{name=~\"login_.*\"}[5m])",
        "legendFormat": "{{name}} - RX"
      }, {
        "expr": "rate(container_network_transmit_bytes_total{name=~\"login_.*\"}[5m])",
        "legendFormat": "{{name}} - TX"
      }],
      "yaxes": [{"format": "Bps"}, {"format": "short"}]
    },
    {
      "title": "Disk I/O (All Containers)",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 22},
      "targets": [{
        "expr": "rate(container_fs_reads_bytes_total{name=~\"login_.*\"}[5m])",
        "legendFormat": "{{name}} - Read"
      }, {
        "expr": "rate(container_fs_writes_bytes_total{name=~\"login_.*\"}[5m])",
        "legendFormat": "{{name}} - Write"
      }],
      "yaxes": [{"format": "Bps"}, {"format": "short"}]
    },
    {
      "title": "System Load Average",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 30},
      "targets": [{
        "expr": "node_load1",
        "legendFormat": "1min"
      }, {
        "expr": "node_load5",
        "legendFormat": "5min"
      }, {
        "expr": "node_load15",
        "legendFormat": "15min"
      }],
      "yaxes": [{"format": "short"}, {"format": "short"}]
    },
    {
      "title": "System Memory",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 30},
      "targets": [{
        "expr": "node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes",
        "legendFormat": "Used"
      }, {
        "expr": "node_memory_MemAvailable_bytes",
        "legendFormat": "Available"
      }],
      "yaxes": [{"format": "bytes"}, {"format": "short"}]
    },
    {
      "title": "Disk Usage",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 38},
      "targets": [{
        "expr": "(node_filesystem_size_bytes{mountpoint=\"/\"} - node_filesystem_avail_bytes{mountpoint=\"/\"}) / node_filesystem_size_bytes{mountpoint=\"/\"} * 100",
        "legendFormat": "Root FS"
      }],
      "yaxes": [{"format": "percent", "max": 100}, {"format": "short"}]
    },
    {
      "title": "Active Alerts",
      "type": "table",
      "gridPos": {"h": 10, "w": 12, "x": 12, "y": 38},
      "targets": [{
        "expr": "ALERTS{alertstate=\"firing\"}",
        "format": "table",
        "instant": true
      }],
      "transformations": [
        {"id": "organize", "options": {"excludeByName": {"Time": true, "__name__": true}}}
      ]
    },
    {
      "title": "Database Connections",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 46},
      "targets": [{
        "expr": "pg_stat_database_numbackends{datname=\"login_db\"}",
        "legendFormat": "Connections"
      }],
      "options": {
        "graphMode": "area",
        "colorMode": "value"
      }
    },
    {
      "title": "Cache Hit Rate",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 46},
      "targets": [{
        "expr": "rate(campaign_cache_hits_total[5m]) / (rate(campaign_cache_hits_total[5m]) + rate(campaign_cache_misses_total[5m])) * 100",
        "legendFormat": "Hit Rate"
      }],
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "unit": "percent"
      }
    },
    {
      "title": "Kafka Consumer Lag",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 46},
      "targets": [{
        "expr": "sum(kafka_consumer_lag)",
        "legendFormat": "Total Lag"
      }],
      "options": {
        "graphMode": "area",
        "colorMode": "value"
      }
    },
    {
      "title": "Total Errors (5m)",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 46},
      "targets": [{
        "expr": "sum(increase(http_requests_total{status_code=~\"5..\"}[5m]))",
        "legendFormat": "Errors"
      }],
      "options": {
        "graphMode": "area",
        "colorMode": "value"
      }
    }
  ]
}
