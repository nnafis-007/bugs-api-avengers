{
  "title": "PostgreSQL Database Dashboard",
  "uid": "database-postgres",
  "tags": ["database", "postgres", "sql"],
  "timezone": "browser",
  "panels": [
    {
      "title": "Database Connections",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
      "targets": [{
        "expr": "pg_stat_database_numbackends{datname=\"login_db\"}",
        "legendFormat": "Active Connections"
      }, {
        "expr": "pg_settings_max_connections",
        "legendFormat": "Max Connections"
      }],
      "yaxes": [{"format": "short"}, {"format": "short"}],
      "alert": {
        "conditions": [{"evaluator": {"params": [80], "type": "gt"}}]
      }
    },
    {
      "title": "Connection State",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
      "targets": [{
        "expr": "pg_stat_activity_count{datname=\"login_db\"}",
        "legendFormat": "{{state}}"
      }],
      "yaxes": [{"format": "short"}, {"format": "short"}]
    },
    {
      "title": "Transactions per Second",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
      "targets": [{
        "expr": "rate(pg_stat_database_xact_commit{datname=\"login_db\"}[5m])",
        "legendFormat": "Commits"
      }, {
        "expr": "rate(pg_stat_database_xact_rollback{datname=\"login_db\"}[5m])",
        "legendFormat": "Rollbacks"
      }],
      "yaxes": [{"format": "tps"}, {"format": "short"}]
    },
    {
      "title": "Tuple Operations",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
      "targets": [{
        "expr": "rate(pg_stat_database_tup_inserted{datname=\"login_db\"}[5m])",
        "legendFormat": "Inserted"
      }, {
        "expr": "rate(pg_stat_database_tup_updated{datname=\"login_db\"}[5m])",
        "legendFormat": "Updated"
      }, {
        "expr": "rate(pg_stat_database_tup_deleted{datname=\"login_db\"}[5m])",
        "legendFormat": "Deleted"
      }, {
        "expr": "rate(pg_stat_database_tup_fetched{datname=\"login_db\"}[5m])",
        "legendFormat": "Fetched"
      }],
      "yaxes": [{"format": "ops"}, {"format": "short"}]
    },
    {
      "title": "Deadlocks",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
      "targets": [{
        "expr": "rate(pg_stat_database_deadlocks{datname=\"login_db\"}[5m])",
        "legendFormat": "Deadlocks/sec"
      }],
      "yaxes": [{"format": "short"}, {"format": "short"}],
      "alert": {
        "conditions": [{"evaluator": {"params": [0], "type": "gt"}}]
      }
    },
    {
      "title": "Cache Hit Ratio",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
      "targets": [{
        "expr": "(pg_stat_database_blks_hit{datname=\"login_db\"} / (pg_stat_database_blks_hit{datname=\"login_db\"} + pg_stat_database_blks_read{datname=\"login_db\"})) * 100",
        "legendFormat": "Cache Hit Ratio"
      }],
      "yaxes": [{"format": "percent", "max": 100, "min": 0}, {"format": "short"}]
    },
    {
      "title": "Database Size",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24},
      "targets": [{
        "expr": "pg_database_size_bytes{datname=\"login_db\"}",
        "legendFormat": "Database Size"
      }],
      "yaxes": [{"format": "bytes"}, {"format": "short"}]
    },
    {
      "title": "Temp Files",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 24},
      "targets": [{
        "expr": "rate(pg_stat_database_temp_files{datname=\"login_db\"}[5m])",
        "legendFormat": "Temp Files Created"
      }, {
        "expr": "rate(pg_stat_database_temp_bytes{datname=\"login_db\"}[5m])",
        "legendFormat": "Temp Bytes Written"
      }],
      "yaxes": [{"format": "short"}, {"format": "bytes"}]
    },
    {
      "title": "Table Stats - Inserts",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32},
      "targets": [{
        "expr": "rate(pg_stat_user_tables_n_tup_ins[5m])",
        "legendFormat": "{{relname}}"
      }],
      "yaxes": [{"format": "ops"}, {"format": "short"}]
    },
    {
      "title": "Table Stats - Updates/Deletes",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32},
      "targets": [{
        "expr": "rate(pg_stat_user_tables_n_tup_upd[5m])",
        "legendFormat": "{{relname}} - Updates"
      }, {
        "expr": "rate(pg_stat_user_tables_n_tup_del[5m])",
        "legendFormat": "{{relname}} - Deletes"
      }],
      "yaxes": [{"format": "ops"}, {"format": "short"}]
    },
    {
      "title": "Sequential vs Index Scans",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 40},
      "targets": [{
        "expr": "rate(pg_stat_user_tables_seq_scan[5m])",
        "legendFormat": "{{relname}} - Seq Scans"
      }, {
        "expr": "rate(pg_stat_user_tables_idx_scan[5m])",
        "legendFormat": "{{relname}} - Index Scans"
      }],
      "yaxes": [{"format": "ops"}, {"format": "short"}]
    },
    {
      "title": "Table Bloat - Dead Tuples",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 40},
      "targets": [{
        "expr": "pg_stat_user_tables_n_dead_tup",
        "legendFormat": "{{relname}}"
      }],
      "yaxes": [{"format": "short"}, {"format": "short"}]
    },
    {
      "title": "Lock Types",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 48},
      "targets": [{
        "expr": "pg_locks_count{datname=\"login_db\"}",
        "legendFormat": "{{mode}}"
      }],
      "yaxes": [{"format": "short"}, {"format": "short"}]
    },
    {
      "title": "Checkpoint Activity",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 48},
      "targets": [{
        "expr": "rate(pg_stat_bgwriter_checkpoints_timed[5m])",
        "legendFormat": "Timed Checkpoints"
      }, {
        "expr": "rate(pg_stat_bgwriter_checkpoints_req[5m])",
        "legendFormat": "Requested Checkpoints"
      }],
      "yaxes": [{"format": "short"}, {"format": "short"}]
    }
  ]
}
