{
  "title": "Backend Consumer Dashboard",
  "uid": "backend-consumer",
  "tags": ["kafka", "consumer", "messaging"],
  "timezone": "browser",
  "panels": [
    {
      "title": "Messages Processed Rate",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
      "targets": [{
        "expr": "rate(kafka_consumer_messages_processed_total{status=\"success\"}[5m])",
        "legendFormat": "Success - {{topic}}"
      }, {
        "expr": "rate(kafka_consumer_messages_processed_total{status=\"error\"}[5m])",
        "legendFormat": "Error - {{topic}}"
      }],
      "yaxes": [{"format": "msg/s"}, {"format": "short"}]
    },
    {
      "title": "Message Processing Duration (p95)",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
      "targets": [{
        "expr": "histogram_quantile(0.95, rate(kafka_consumer_message_processing_duration_seconds_bucket[5m]))",
        "legendFormat": "{{topic}}"
      }],
      "yaxes": [{"format": "s"}, {"format": "short"}]
    },
    {
      "title": "Consumer Lag",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
      "targets": [{
        "expr": "kafka_consumer_lag",
        "legendFormat": "{{topic}} - partition {{partition}}"
      }],
      "yaxes": [{"format": "short"}, {"format": "short"}],
      "alert": {
        "conditions": [{"evaluator": {"params": [100], "type": "gt"}}]
      }
    },
    {
      "title": "Consumer Errors",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
      "targets": [{
        "expr": "rate(kafka_consumer_errors_total[5m])",
        "legendFormat": "{{topic}} - {{error_type}}"
      }],
      "yaxes": [{"format": "errors/s"}, {"format": "short"}]
    },
    {
      "title": "Total Messages Processed",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 16},
      "targets": [{
        "expr": "sum(kafka_consumer_messages_processed_total)",
        "legendFormat": "Total"
      }],
      "options": {
        "graphMode": "area",
        "colorMode": "value"
      }
    },
    {
      "title": "Processing Success Rate",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 16},
      "targets": [{
        "expr": "sum(rate(kafka_consumer_messages_processed_total{status=\"success\"}[5m])) / sum(rate(kafka_consumer_messages_processed_total[5m])) * 100",
        "legendFormat": "Success Rate"
      }],
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "unit": "percent"
      }
    },
    {
      "title": "Consumer Health",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 16},
      "targets": [{
        "expr": "up{job=\"backend-consumer\"}",
        "legendFormat": "Status"
      }],
      "options": {
        "graphMode": "none",
        "colorMode": "background",
        "mappings": [
          {"value": 1, "text": "UP", "color": "green"},
          {"value": 0, "text": "DOWN", "color": "red"}
        ]
      }
    },
    {
      "title": "CPU Usage",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 20},
      "targets": [{
        "expr": "rate(container_cpu_usage_seconds_total{name=\"login_backend_consumer\"}[1m]) * 100",
        "legendFormat": "CPU %"
      }],
      "yaxes": [{"format": "percent", "max": 100}, {"format": "short"}]
    },
    {
      "title": "Memory Usage",
      "type": "graph",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 20},
      "targets": [{
        "expr": "container_memory_usage_bytes{name=\"login_backend_consumer\"}",
        "legendFormat": "Memory Used"
      }],
      "yaxes": [{"format": "bytes"}, {"format": "short"}]
    }
  ]
}
